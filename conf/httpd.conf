<VirtualHost *:443>
  ServerName    tiv.site.loc
  DocumentRoot  /data/lamp/www/tiv/htdocs
  #AddType         application/x-httpd-php .php
  #<FilesMatch "\.php$">
   # SetHandler application/x-httpd-php
  #</FilesMatch>
  DirectoryIndex  index.php
  #CustomLog     /data/lamp/www/tiv/data/dm/log/request.log combined
  #CustomLog "|/opt/apache/2.2/23/bin/rotatelogs -l /data/lamp/www/tiv/data/dm/log/request.log.%Y.%m.%d 86400" combined

  # KeepAlive to off
  KeepAlive Off

  SSLEngine on
  SSLCertificateFile /ssl/_wildcard.site.loc.pem
  SSLCertificateKeyFile /ssl/_wildcard.site.loc-key.pem


<Directory /data/lamp/www/tiv/htdocs>
Options +FollowSymLinks +ExecCGI

# Add correct content-type for fonts
AddType application/vnd.ms-fontobject .eot
AddType application/x-font-ttf .ttf
AddType application/x-font-opentype .otf
AddType application/x-font-woff .woff
AddType image/svg+xml .svg

# add deflate
<IfModule mod_deflate.c>
  # compress text, html, javascript, css, xml:
  AddOutputFilterByType DEFLATE text/plain
  AddOutputFilterByType DEFLATE text/html
  AddOutputFilterByType DEFLATE text/xml
  AddOutputFilterByType DEFLATE text/css
  AddOutputFilterByType DEFLATE application/xml
  AddOutputFilterByType DEFLATE application/xhtml+xml
  AddOutputFilterByType DEFLATE application/rss+xml
  AddOutputFilterByType DEFLATE application/javascript
  AddOutputFilterByType DEFLATE application/x-javascript
  AddOutputFilterByType DEFLATE application/json
  AddOutputFilterByType DEFLATE text/json

  # Compress compressible fonts
  AddOutputFilterByType DEFLATE application/x-font-ttf application/x-font-opentype image/svg+xml
</IfModule>

# Add expiration dates to static content
# sudo a2enmod expires && sudo apache2ctl restart
<IfModule mod_expires.c>
  ExpiresActive On
  ExpiresByType image/gif "access plus 1 year"
  ExpiresByType image/png "access plus 1 year"
  ExpiresByType image/jpg "access plus 1 year"
  ExpiresByType image/jpeg "access plus 1 year"
  ExpiresByType image/png "access plus 1 year"
  ExpiresByType image/x-icon "access plus 1 year"
  ExpiresByType image/svg+xml "access plus 1 year"  
  ExpiresByType text/css "access plus 1 year"
  ExpiresByType text/javascript "access plus 1 year"
  ExpiresByType application/x-Shockwave-Flash "access plus 1 year"
  ExpiresByType application/vnd.ms-fontobject "access plus 1 year"
  ExpiresByType application/x-font-ttf "access plus 1 year"
  ExpiresByType application/x-font-opentype "access plus 1 year"
  ExpiresByType application/x-font-woff "access plus 1 year"
</IfModule>
 
<IfModule mod_rewrite.c>
  # SEND GZIPPED CONTENT TO COMPATIBLE BROWSERS
   RemoveType .gz
   RemoveOutputFilter .css .js
   AddEncoding x-gzip .gz
   AddType "text/css;charset=utf-8" .css
   AddType "text/javascript;charset=utf-8" .js
   RewriteCond %{HTTP:Accept-Encoding} gzip
   RewriteCond %{REQUEST_FILENAME}.gz -f
   RewriteRule ^(.*)$ $1.gz [L,QSA]
  # END GZIPPED CONTENT

  RewriteEngine On
  # uncomment the following line, if you are having trouble
  # getting no_script_name to work
  
  #RewriteBase /
  
  #RewriteRule ^(.+)/$ $1 [R=301,L]

  #RewriteCond %{REQUEST_URI} ^/\.well-known/acme-challenge$ [OR] # permission granted for letsencryptchallenge

  # we skip all files with .something
  #RewriteCond %{REQUEST_URI} \..+$
  #RewriteCond %{REQUEST_URI} !\.html$
  #RewriteCond %{REQUEST_URI} !\.htm$
  #RewriteCond %{REQUEST_URI} !\.asp$
  #RewriteCond %{REQUEST_URI} !\.aspx$
  #RewriteCond %{REQUEST_URI} !\.swf$
  #RewriteCond %{REQUEST_URI} !\.com$

  # all followed .php files are executed as a script
  #RewriteCond %{REQUEST_URI} ^/dev\.php$ [OR] 
  #RewriteCond %{REQUEST_URI} ^/admin_cache\.php$ [OR]
  #RewriteCond %{REQUEST_URI} ^/admin_dev\.php$ [OR]
  #RewriteCond %{REQUEST_URI} ^/admin-iframe\.php$ [OR]
  #RewriteCond %{REQUEST_URI} ^/admin_less\.php$ [OR]
  #RewriteCond %{REQUEST_URI} ^/admin\.php$ [OR]
  #RewriteCond %{REQUEST_URI} ^/cache\.php$ [OR]
  #RewriteCond %{REQUEST_URI} ^/dm_check\.php$ [OR]
  #RewriteCond %{REQUEST_URI} ^/index\.php$ [OR]
  #RewriteCond %{REQUEST_URI} ^/less\.php$ [OR]
  #RewriteCond %{REQUEST_URI} ^/phpinfo\.php$ [OR]
  #RewriteCond %{REQUEST_URI} ^/forum/.*\.php$ [OR] # permission granted for /forum/ files
  #RewriteCond %{REQUEST_URI} ^/misc/.*\.php$ [OR] # permission granted for /misc/ php files
  #RewriteCond %{REQUEST_URI} ^/filemanager/.*\.php$ [OR] # permission granted for /forum/ files
  # all other .php files are rewriten (for example launch a 404 error if dont exists) 
  #RewriteCond %{REQUEST_URI} !\.php$

  #RewriteRule .* - [L]

  # we check if the .html version is here (caching)
  #RewriteRule ^$ index.html [QSA]
  #RewriteRule ^([^.]+)$ $1.html [QSA]
  #RewriteCond %{REQUEST_FILENAME} !-f

  # no, so we redirect to our front web controller
  #RewriteRule ^(.*)$ index.php [QSA,L]
</IfModule>

<IfModule mod_xsendfile.c>
  XSendFile On
  XSendFilePath "/data/lamp/www/tiv"
</IfModule> 

</Directory>
</VirtualHost>

<VirtualHost *:80>
  ServerName tiv.site.loc
  Redirect / https://tiv.site.loc
</VirtualHost>
